var AppControllers=angular.module("AppControllers",[]);AppControllers.controller("homeController",["$scope","CommonData","ResortService",function($scope,CommonData,ResortService){$scope.data="",$scope.displayText="",$scope.setData=function(){CommonData.setData($scope.data),$scope.displayText="Data set"}}]),AppControllers.controller("favoritesController",["$scope","CommonData","UserService",function($scope,CommonData,UserService){$scope.data="",$scope.displayText="";var quest="users/"+CommonData.get_user()._id+"/favorite/";UserService.get_service(quest,function(data){$scope.search_result=data,console.log($scope.search_result),$scope.pagination=Pagination.getNew(16),$scope.pagination.numPages=Math.ceil($scope.search_result.length/$scope.pagination.perPage)}),console.log("get this user's favorites"),console.log(username)}]),AppControllers.controller("mainController",["$scope","CommonData","UserService","ResortService","$location",function($scope,CommonData,UserService,ResortService,$location){$scope.data={},$scope.displayText="",$scope.login_status=CommonData.get_login(),$scope.formData={},$scope.setData=function(){CommonData.setData($scope.data),$scope.displayText="Data set"},$scope.suggest=function(){console.log("ff"),ResortService.get_service("resorts/random/",function(data){$location.path("/details/"+data[0]._id),console.log(data)})},$scope.switchToSignup=function(){$("#desktop_login_form").foundation("close"),$("#desktop_signup_form").foundation("open")},$scope.switchToLogin=function(){$("#desktop_signup_form").foundation("close"),$("#desktop_login_form").foundation("open")},$scope.joinus=function(){$scope.username=document.getElementById("username_signup").value,$scope.password=document.getElementById("password_signup").value,$scope.zipcode=document.getElementById("zipcode").value,data={email:$scope.username,password:$scope.password,zipcode:$scope.zipcode};var zipChecker=/^\d{5}(?:[-\s]\d{4})?$/.test($scope.zipcode);zipChecker&&UserService.post_service("signup",data,function(data){$scope.user=data,"Unauthorized"==data?$("#desktop_singup_form").animo({animation:"tada",duration:.5,keep:!1},function(){}):($scope.login_status=!0,$("#desktop_signup_form").foundation("close"),CommonData.signup(data.user))})},$scope.login=function(){$scope.username=document.getElementById("username").value,$scope.password=document.getElementById("password").value,$scope.zipcode="",data={email:$scope.username,password:$scope.password},UserService.post_service("login",data,function(data){$scope.user=data,"Unauthorized"==data?$("#desktop_login_form").animo({animation:"tada",duration:.5,keep:!1},function(){}):($("#desktop_login_form").foundation("close"),$scope.login_status=!0,CommonData.login(data.user),$scope.zipcode=data.user.zipcode)})},$scope.logout=function(){$scope.login_status=!1,CommonData.logout()}}]),AppControllers.controller("detailsController",["$scope","CommonData","$routeParams","ResortService","UserService",function($scope,CommonData,$routeParams,ResortService,UserService){var query='resorts?where={"_id":"'+$routeParams.id+'"}',check_fav=function(user){$scope.is_faved=!1;for(var i=0;i<user.favoriteResorts.length;i++)user.favoriteResorts[i]===$routeParams.id&&(console.log("same"),$scope.is_faved=!0);console.log($scope.is_faved)};if(CommonData.get_login()){var user=CommonData.get_user();check_fav(user)}else $scope.is_faved=!1;ResortService.get_service(query,function(data){console.log(data),$scope.resort=data[0],$scope.resort.Location.replace(",,",",");var s=$scope.resort.Description,p=s.slice(s.length/2).split(" ").slice(1).join(" ").length;$scope.word_1=s.slice(0,s.length-p),$scope.word_2=s.slice(s.length-p)}),$scope.favorite=function(){var user=CommonData.get_user(),query2="users/"+user._id+"/favorite/"+$routeParams.id;CommonData.get_login()?$scope.is_faved?UserService.delete_service(query2,function(data){CommonData.login(data),user=data,check_fav(user)}):UserService.post_service_fav(query2,function(data){user=data,CommonData.login(data),check_fav(user)}):$("#desktop_login_form").foundation("open")}}]),AppControllers.controller("functionController",["$scope","$http","$window","ResortService","Pagination","CommonData",function($scope,$http,$window,ResortService,Pagination,CommonData){$scope.search_parameter="",$scope.hidePagination=!0,$scope.zipcode="",$scope.is_loading=!1,CommonData.get_login()&&($scope.zipcode=CommonData.get_user().zipcode),CommonData.get_search_status()&&($scope.search_result=CommonData.get_search_data(),$scope.pagination=Pagination.getNew(16),$scope.pagination.numPages=Math.ceil($scope.search_result.length/$scope.pagination.perPage)),$scope.price_slider={minValue:10,maxValue:50,options:{ceil:200,floor:0,step:10,showTicksValues:!1,getSelectionBarColor:function(value){return"#7A9D96"},getPointerColor:function(value){return"#7A9D96"}}},$scope.distance_slider={minValue:100,maxValue:3e3,options:{ceil:3e3,floor:0,step:100,showTicksValues:!1,getSelectionBarColor:function(value){return"#7A9D96"},getPointerColor:function(value){return"#7A9D96"}}},$scope.p_t={minValue:10,maxValue:60,options:{ceil:100,floor:0,step:1,showTicksValues:!1,getSelectionBarColor:function(value){return"#7A9D96"},getPointerColor:function(value){return"#7A9D96"}}},$scope.search=function(){zipcode_request="distances/"+$scope.zipcode,$scope.is_loading=!0,$scope.hidePagination=!1;var get_request="resorts?where={ Price: { $gt: "+$scope.price_slider.minValue.toString()+", $lt: "+$scope.price_slider.maxValue.toString()+" }, Percent_trails_open: { $gt:"+($scope.p_t.minValue/100-.01).toString()+", $lt:"+($scope.p_t.maxValue/100).toString()+"}, Distance:  { $gt: "+$scope.distance_slider.minValue.toString()+", $lt:"+$scope.distance_slider.maxValue.toString()+'},"name": {$regex:"'+$scope.search_parameter+'"}}';console.log(get_request),ResortService.put_service(zipcode_request,function(){ResortService.get_service(get_request,function(data){$scope.is_loading=!1,$scope.search_result=data,CommonData.set_search_status(),CommonData.set_search_data(data),console.log($scope.search_result),$scope.pagination=Pagination.getNew(16),$scope.pagination.numPages=Math.ceil($scope.search_result.length/$scope.pagination.perPage)})})}}]);